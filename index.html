<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de P√≥ster Pro V8</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; display: flex; height: 100vh; }
    #toolbar { width: 300px; background: #fafafa; padding: 20px; overflow-y: auto; border-right: 1px solid #ddd; }
    #toolbar h2 { margin-top: 20px; font-size: 1.1em; }
    #toolbar label { display: block; margin: 10px 0 5px; }
    #toolbar input[type="text"], #toolbar textarea, #toolbar select, #toolbar input[type="color"], #toolbar input[type="range"] {
      width:100%; padding:5px; font-size: 0.9em;
    }
    #toolbar input[type="file"] { padding:5px; }
    #toolbar .icon { width:32px; cursor:move; margin:5px; }
    #canvas-container { flex:1; display:flex; align-items:center; justify-content:center; background:#eaeaea; }
    canvas { border:1px solid #ccc; }
    button { margin-top:10px; padding:10px; width:100%; font-size: 1em; }
  </style>
</head>
<body>
  <div id="toolbar">
    <h1>Poster Pro V8</h1>
    <h2>T√≠tulos</h2>
    <label>Main Title</label><input type="text" id="mainTitle" value="V20">
    <label>Subtitle</label><input type="text" id="subTitle" value="PRO">
    <label>Third Title</label><input type="text" id="thirdTitle" value="FATBIKE">

    <h2>Frase destacada</h2>
    <textarea id="featureLine">¬°Potente, robusta y lista para cualquier terreno!</textarea>

    <h2>Especificaciones</h2>
    <div id="specsContainer"></div>
    <button id="addSpec">+ A√±adir especificaci√≥n</button>

    <h2>Ofertas</h2>
    <label><input type="checkbox" id="offerSpecial" checked> Oferta Especial</label>
    <label><input type="checkbox" id="offerShipping" checked> Env√≠o Gratis</label>
    <label><input type="checkbox" id="offerCOD" checked> Pago contra reembolso</label>

    <h2>WhatsApp</h2>
    <label>N√∫mero</label><input type="text" id="whatsapp" value="+34 632 759 513">

    <h2>Fondo Interactivo</h2>
    <label>Color inicial</label><input type="color" id="bgColor1" value="#001c40">
    <label>Color final</label><input type="color" id="bgColor2" value="#007BFF">
    <label>√Ångulo del degradado (0¬∞-360¬∞)</label><input type="range" id="bgAngle" min="0" max="360" value="90">
    <button id="resetGradient">Resetear Gradient</button>

    <h2>Imagen Fondo</h2>
    <input type="file" id="bgImageInput" accept="image/*">

    <h2>Imagen Producto</h2>
    <input type="file" id="prodImageInput" accept="image/*">

    <h2>Iconos</h2>
    <div id="iconLibrary">
      <img src="assets/icons/bolt.svg" class="icon" draggable="true">
      <img src="assets/icons/battery.svg" class="icon" draggable="true">
      <img src="assets/icons/speed.svg" class="icon" draggable="true">
    </div>

    <h2>Tama√±o del p√≥ster</h2>
    <select id="canvasSize">
      <option value="1080x1350">Vertical 1080√ó1350</option>
      <option value="1080x1080">Cuadrado 1080√ó1080</option>
      <option value="720x1280">Vertical 720√ó1280</option>
      <option value="1920x1080">Horizontal 1920√ó1080</option>
    </select>

    <button id="deleteBtn">üóëÔ∏è Eliminar elemento seleccionado</button>
    <button id="exportBtn">Exportar PNG</button>
  </div>
  <div id="canvas-container">
    <canvas id="canvas" width="1080" height="1350"></canvas>
  </div>
  <script>
    const canvas = new fabric.Canvas('canvas', { preserveObjectStacking: true });
    canvas.selection = true;

    // Background gradient rectangle
    const bgRect = new fabric.Rect({ left:0, top:0, width:canvas.width, height:canvas.height, selectable:false });
    canvas.add(bgRect);

    function updateGradient() {
      const c1 = document.getElementById('bgColor1').value;
      const c2 = document.getElementById('bgColor2').value;
      const angleDeg = document.getElementById('bgAngle').value;
      const angle = angleDeg * (Math.PI/180);
      const x1 = 0.5 - 0.5*Math.cos(angle);
      const y1 = 0.5 - 0.5*Math.sin(angle);
      const x2 = 0.5 + 0.5*Math.cos(angle);
      const y2 = 0.5 + 0.5*Math.sin(angle);
      const gradient = new fabric.Gradient({
        type: 'linear',
        coords: {
          x1: canvas.width * x1,
          y1: canvas.height * y1,
          x2: canvas.width * x2,
          y2: canvas.height * y2
        },
        colorStops: [
          { offset: 0, color: c1 },
          { offset: 1, color: c2 }
        ]
      });
      bgRect.set('fill', gradient);
      canvas.sendToBack(bgRect);
      canvas.renderAll();
    }
    document.getElementById('bgColor1').onchange = updateGradient;
    document.getElementById('bgColor2').onchange = updateGradient;
    document.getElementById('bgAngle').oninput = updateGradient;
    document.getElementById('resetGradient').onclick = () => {
      document.getElementById('bgAngle').value = 90;
      document.getElementById('bgColor1').value = '#001c40';
      document.getElementById('bgColor2').value = '#007BFF';
      updateGradient();
    };
    updateGradient();

    // Titles
    const titleMain = new fabric.Textbox('V20', { left:50, top:50, width:500, fontSize:72, fill:'#cce6ff', fontFamily:'Montserrat', shadow:new fabric.Shadow({ color:'#00f0ff', blur:15 }) });
    const titleSub = new fabric.Textbox('PRO', { left:200, top:130, width:300, fontSize:48, fill:'#cce6ff', fontFamily:'Montserrat' });
    const titleThird = new fabric.Textbox('FATBIKE', { left:50, top:190, width:400, fontSize:54, fill:'#cce6ff', fontFamily:'Montserrat' });
    canvas.add(titleMain, titleSub, titleThird);

    document.getElementById('mainTitle').oninput = e => { titleMain.text = e.target.value; canvas.renderAll(); };
    document.getElementById('subTitle').oninput = e => { titleSub.text = e.target.value; canvas.renderAll(); };
    document.getElementById('thirdTitle').oninput = e => { titleThird.text = e.target.value; canvas.renderAll(); };

    // Feature line
    const featureText = new fabric.Textbox(document.getElementById('featureLine').value, { left:50, top:260, width:600, fontSize:28, fill:'white', fontFamily:'Roboto' });
    canvas.add(featureText);
    document.getElementById('featureLine').oninput = e => { featureText.text = e.target.value; canvas.renderAll(); };

    // Specs
    const specs = [];
    function addSpec(text='Nueva especificaci√≥n') {
      const y = 330 + specs.length * 40;
      const tb = new fabric.Textbox('‚ö° ' + text, { left:50, top:y, width:500, fontSize:24, fill:'white', fontFamily:'Roboto' });
      specs.push(tb);
      canvas.add(tb);
      canvas.renderAll();
    }
    document.getElementById('addSpec').onclick = () => addSpec();
    addSpec('Motor 250W');
    addSpec('Bater√≠a 36V');

    // Offers with rounded corners
    function createOffer(text, color, top) {
      const rect = new fabric.Rect({ width:300, height:50, fill: color, rx: 15, ry: 15 });
      const txt = new fabric.Text(text, { fontSize:24, fill:'white', fontFamily:'Roboto' });
      const grp = new fabric.Group([rect, txt], { left:50, top:top });
      canvas.add(grp);
      return grp;
    }
    const offerGroups = {
      offerSpecial: createOffer('OFERTA ESPECIAL', 'red', 600),
      offerShipping: createOffer('ENV√çO GRATIS', 'gold', 660),
      offerCOD: createOffer('Pago contra reembolso', 'orange', 720)
    };
    ['offerSpecial', 'offerShipping', 'offerCOD'].forEach(id => {
      document.getElementById(id).onchange = e => {
        offerGroups[id].visible = e.target.checked;
        canvas.renderAll();
      };
    });

    // WhatsApp
    const whatsappBox = new fabric.Textbox('üì± ' + document.getElementById('whatsapp').value, {
      left:50, top:780, width:500, fontSize:24, fill:'black', backgroundColor:'white', fontFamily:'Roboto', padding:5
    });
    canvas.add(whatsappBox);
    document.getElementById('whatsapp').oninput = e => {
      whatsappBox.text = 'üì± ' + e.target.value;
      canvas.renderAll();
    };

    // Delete element
    document.getElementById('deleteBtn').onclick = () => {
      const active = canvas.getActiveObject();
      if (active) {
        canvas.remove(active);
        canvas.discardActiveObject();
        canvas.renderAll();
      }
    };

    // Canvas size change
    document.getElementById('canvasSize').onchange = e => {
      const [w, h] = e.target.value.split('x').map(Number);
      canvas.setWidth(w).setHeight(h);
      bgRect.set({ width: w, height: h });
      if (canvas.backgroundImage) {
        canvas.backgroundImage.set({ width: w, height: h });
      }
      updateGradient();
      canvas.renderAll();
    };

    // Background image upload
    document.getElementById('bgImageInput').onchange = e => {
      const reader = new FileReader();
      reader.onload = evt => {
        fabric.Image.fromURL(evt.target.result, img => {
          img.set({ left:0, top:0, width: canvas.width, height: canvas.height, selectable:false });
          canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
        });
      };
      reader.readAsDataURL(e.target.files[0]);
    };

    // Product image upload
    document.getElementById('prodImageInput').onchange = e => {
      const reader = new FileReader();
      reader.onload = evt => {
        fabric.Image.fromURL(evt.target.result, img => {
          img.set({ left:600, top:300, scaleX:0.5, scaleY:0.5 });
          canvas.add(img);
          canvas.sendBackwards(img);
          canvas.renderAll();
        });
      };
      reader.readAsDataURL(e.target.files[0]);
    };

    // Icon drag & drop
    document.querySelectorAll('.icon').forEach(icon => {
      icon.ondragstart = e => e.dataTransfer.setData('text/plain', icon.src);
    });
    canvas.on('drop', e => {
      const src = e.e.dataTransfer.getData('text/plain');
      fabric.Image.fromURL(src, img => {
        img.set({ left: e.pointer.x, top: e.pointer.y, scaleX:0.3, scaleY:0.3 });
        canvas.add(img);
        canvas.renderAll();
      });
    });

    // Export poster
    document.getElementById('exportBtn').onclick = () => {
      const link = document.createElement('a');
      link.download = 'poster.png';
      link.href = canvas.toDataURL({ format:'png', quality:1 });
      link.click();
    };
  </script>
</body>
</html>